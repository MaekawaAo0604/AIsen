# AIsen アプリケーション - 包括的テスト計画

## アプリケーション概要

AIsenは、アイゼンハワー・マトリクス（4象限マトリクス）を用いたタスク管理アプリケーションです。タスクを「重要度」と「緊急度」の2軸で分類し、優先順位を明確にすることで、効率的な時間管理を実現します。

### 主要機能

#### コア機能（Free プラン）
- **4象限タスク管理**: Q1（緊急×重要）、Q2（重要）、Q3（緊急）、Q4（その他）への分類
- **タスクCRUD操作**: 作成・表示・編集・削除
- **ドラッグ&ドロップ**: 象限間でのタスク移動
- **タスク完了管理**: チェックボックスによる完了/未完了の切り替え
- **ボード保存・共有**: URL経由でのボード共有（read-only）
- **Quick Add機能**: `q`キーによる高速タスク追加
- **レスポンシブデザイン**: デスクトップ・タブレット・スマートフォン対応

#### Pro機能
- **Gmail連携**: 指定ラベル/スターメールからのタスク自動取り込み
- **AI一括整理**: OpenAI APIを使用した象限への自動分類
- **AIブレインストーミング**: タスク配置時のAI対話サポート（1日5回まで無料）

### アーキテクチャ
- **フロントエンド**: Next.js 15 (App Router), React 19, TypeScript
- **状態管理**: Zustand
- **スタイリング**: Tailwind CSS 4
- **バックエンド**: Firebase (Firestore, Authentication)
- **AI**: OpenAI API (gpt-4o-mini)
- **ドラッグ&ドロップ**: dnd-kit

### ページ構成
- `/` - ランディングページ
- `/b/new` - 新規ボード作成
- `/b/[boardId]` - ボード編集画面
- `/boards` - マイボード一覧（ログイン時）
- `/inbox` - Gmail Inbox（Pro機能）
- `/pricing` - 料金プラン
- `/settings` - 設定
- `/s/[token]` - 共有ボード（read-only）
- `/s/DEMO` - デモボード

---

## テストシナリオ

### 1. ランディングページ (LP)

**Seed:** `tests/e2e/landing-page.spec.ts`

#### 1.1 LP基本表示
**Steps:**
1. ブラウザで `http://localhost:3000` にアクセス
2. ページが完全に読み込まれるまで待機

**Expected Results:**
- ページタイトルが「AIsen - 自動仕分けタスク管理」と表示される
- ヘッダーに「AIsen」ロゴと「Gmail × AI で自動整理」が表示される
- ナビゲーションに「機能」「料金」「無料で始める」リンクが表示される
- ヒーローセクションのH1が「朝イチの「今日なにからやるか」を、AI に丸投げできるタスクボード。」と表示される
- CTAボタン「無料で始める」「デモを見る」が表示される
- 4象限ボードのモックアップが表示される

#### 1.2 ナビゲーションリンク
**Steps:**
1. LP (`/`) にアクセス
2. 「機能」リンクをクリック
3. 「料金」リンクをクリック
4. 「無料で始める」ボタンをクリック

**Expected Results:**
- 「機能」クリック → ページ内の `#features` セクションへスクロール
- 「料金」クリック → `/pricing` ページへ遷移
- 「無料で始める」クリック → `/b/new` ページへ遷移

#### 1.3 デモボタン
**Steps:**
1. LP (`/`) にアクセス
2. 「デモを見る」ボタンをクリック

**Expected Results:**
- `/s/DEMO` ページへ遷移
- デモボードが表示され、9件のサンプルタスクが配置されている
- すべてのタスクが `disabled` 状態（read-only）

---

### 2. 新規ボード作成とサンプルタスク

**Seed:** `tests/e2e/board-creation.spec.ts`

#### 2.1 新規ボード作成
**Steps:**
1. `/b/new` にアクセス

**Expected Results:**
- ユニークなボードIDが生成され、`/b/[boardId]` へリダイレクト
- ページタイトルが「AIsen - アイゼンハワー・マトリクス タスク管理」と表示される
- 4つのサンプルタスクが自動的に配置される:
  - Q1: 「今日中に返信するメール」
  - Q2: 「今週中に進めたい資料作成」
  - Q3: 「出席だけしておけばいい定例会議」
  - Q4: 「やらないと決めたこと」
- 「自動保存されています」メッセージが表示される
- 「この URL をブックマークすると いつでも続きから再開できます」メッセージが表示される

#### 2.2 URL永続性
**Steps:**
1. `/b/new` で新規ボード作成
2. 表示されたURLをコピー
3. ブラウザをリロード
4. 別タブで同じURLを開く

**Expected Results:**
- リロード後も同じタスクが表示される
- 別タブでも同じボード状態が表示される
- LocalStorageにボードデータが保存されている

---

### 3. タスク作成

**Seed:** `tests/e2e/task-creation.spec.ts`

#### 3.1 新規タスク作成（最小構成）
**Steps:**
1. ボード画面 (`/b/[boardId]`) にアクセス
2. 「新しいタスクを追加」ボタンをクリック
3. タイトル入力欄に「テスト用タスク」と入力
4. 「Q1: 今すぐやる」ボタンをクリック
5. 「配置する」ボタンをクリック

**Expected Results:**
- TaskPlacementModal が表示される
- タイトル未入力時は「配置する」ボタンが `disabled`
- タイトル入力後は「配置する」ボタンが有効化
- Q1選択時は「Q1: 今すぐやる」ボタンが `active` スタイル
- タスクがQ1象限に追加される
- モーダルが自動的に閉じる
- 追加日時が自動で付与される（例: 🕒 追加: 2025/12/2）

#### 3.2 新規タスク作成（詳細付き）
**Steps:**
1. 「新しいタスクを追加」ボタンをクリック
2. タイトル: 「詳細付きタスク」
3. 詳細・サブタスク: 「サブタスク1、サブタスク2」
4. 期限: 「2025-12-31」
5. 「Q2: 計画してやる」を選択
6. 「配置する」ボタンをクリック

**Expected Results:**
- タスクがQ2象限に追加される
- タスクカードに詳細とサブタスクが表示される
- 期限が「📅 期限: 2025/12/31」として表示される

#### 3.3 各象限へのタスク作成
**Steps:**
1. Q1、Q2、Q3、Q4それぞれにタスクを1つずつ作成

**Expected Results:**
- すべての象限にタスクが正しく配置される
- 各象限のタスク数が正しくカウントされる

#### 3.4 タスク作成キャンセル
**Steps:**
1. 「新しいタスクを追加」ボタンをクリック
2. タイトルに「キャンセルするタスク」と入力
3. 「キャンセル」ボタンをクリック

**Expected Results:**
- モーダルが閉じる
- タスクは作成されない
- ボードの状態は変更されない

#### 3.5 空タイトルでの作成防止
**Steps:**
1. 「新しいタスクを追加」ボタンをクリック
2. タイトルを空のまま「Q1: 今すぐやる」を選択

**Expected Results:**
- 「配置する」ボタンが `disabled` 状態のまま
- クリックしても何も起こらない

---

### 4. タスク表示と詳細

**Seed:** `tests/e2e/task-display.spec.ts`

#### 4.1 タスク詳細モーダル表示
**Steps:**
1. ボード画面で任意のタスクカードをクリック

**Expected Results:**
- TaskDetailModal が画面全体にオーバーレイ表示される
- モーダルヘッダーにタスクタイトルが表示される
- 作成日時が「作成日: 2025/12/2 18:40:58」形式で表示される
- 「閉じる」ボタンが表示される

#### 4.2 タスク詳細モーダルを閉じる
**Steps:**
1. タスクカードをクリックして詳細モーダルを開く
2. 「閉じる」ボタンをクリック

**Expected Results:**
- モーダルが閉じる
- ボード画面に戻る

#### 4.3 タスクカード基本情報表示
**Steps:**
1. 各象限のタスクカードを確認

**Expected Results:**
- タスクタイトルが表示される
- 追加日時（🕒 追加: YYYY/MM/DD）が表示される
- 期限が設定されている場合は「📅 期限: YYYY/MM/DD」が表示される
- チェックボックス（完了切り替え用）が表示される
- メニューボタン（...）が表示される

---

### 5. タスク編集

**Seed:** `tests/e2e/task-edit.spec.ts`

#### 5.1 タスクタイトル編集
**Steps:**
1. タスクカードのメニューボタン（...）をクリック
2. 「編集」を選択
3. タイトルを「編集後のタスク」に変更
4. 「保存」ボタンをクリック

**Expected Results:**
- タスクカードのタイトルが「編集後のタスク」に更新される
- 変更が即座にUIに反映される
- LocalStorageに保存される

#### 5.2 タスク詳細編集
**Steps:**
1. タスク編集モーダルを開く
2. 詳細欄に「編集後の詳細」と入力
3. 期限を「2025-12-25」に変更
4. 「保存」ボタンをクリック

**Expected Results:**
- 詳細と期限が更新される
- タスクカードに新しい期限が表示される

---

### 6. タスク削除

**Seed:** `tests/e2e/task-delete.spec.ts`

#### 6.1 タスク削除
**Steps:**
1. タスクカードのメニューボタン（...）をクリック
2. 「削除」を選択
3. 確認ダイアログで「削除」を選択

**Expected Results:**
- タスクがボードから削除される
- 象限のタスク数が1減る
- 削除は取り消せない

#### 6.2 タスク削除キャンセル
**Steps:**
1. タスクカードのメニューボタン（...）をクリック
2. 「削除」を選択
3. 確認ダイアログで「キャンセル」を選択

**Expected Results:**
- タスクは削除されない
- ダイアログが閉じる
- ボードの状態は変更されない

---

### 7. タスク完了管理

**Seed:** `tests/e2e/task-completion.spec.ts`

#### 7.1 タスク完了切り替え
**Steps:**
1. 未完了タスクのチェックボックスをクリック

**Expected Results:**
- タスクが完了状態になる
- タスクカードに打ち消し線が表示される（または視覚的な変更）
- チェックボックスがチェック済み状態になる

#### 7.2 タスク未完了に戻す
**Steps:**
1. 完了済みタスクのチェックボックスをクリック

**Expected Results:**
- タスクが未完了状態に戻る
- 打ち消し線が解除される
- チェックボックスが未チェック状態になる

#### 7.3 完了タスクのアーカイブ表示
**Steps:**
1. 複数のタスクを完了状態にする
2. 象限内の完了タスクセクションを確認

**Expected Results:**
- 完了タスクが別セクション（折りたたみ式）に移動する
- 未完了タスクと完了タスクが視覚的に分離される

---

### 8. ドラッグ&ドロップ

**Seed:** `tests/e2e/drag-and-drop.spec.ts`

#### 8.1 象限間でタスクを移動
**Steps:**
1. Q1象限のタスクをドラッグ
2. Q2象限にドロップ

**Expected Results:**
- タスクがQ1からQ2へ移動する
- Q1のタスク数が1減る
- Q2のタスク数が1増える
- 変更がLocalStorageに保存される

#### 8.2 同一象限内でタスクを並び替え
**Steps:**
1. Q1象限内で最初のタスクをドラッグ
2. 2番目のタスクの下にドロップ

**Expected Results:**
- タスクの順序が入れ替わる
- 象限のタスク数は変わらない

#### 8.3 ドラッグキャンセル
**Steps:**
1. タスクをドラッグ開始
2. 元の位置に戻してドロップ

**Expected Results:**
- タスクの位置が変わらない
- ボードの状態は変更されない

---

### 9. Quick Add機能（qキー）

**Seed:** `tests/e2e/quick-add.spec.ts`

#### 9.1 qキーでQuick Add起動
**Steps:**
1. ボード画面で `q` キーを押す

**Expected Results:**
- QuickAddModal が表示される
- タイトル入力欄にフォーカスが当たる

#### 9.2 Quick Addでタスク作成
**Steps:**
1. `q` キーを押す
2. 「緊急の顧客対応」と入力
3. Enterキーを押す

**Expected Results:**
- タイトルから重要度・緊急度を自動判定
- 適切な象限（おそらくQ1）に自動配置される
- モーダルが閉じる

#### 9.3 Quick Addキャンセル
**Steps:**
1. `q` キーを押す
2. Escキーを押す

**Expected Results:**
- モーダルが閉じる
- タスクは作成されない

---

### 10. ボード共有機能

**Seed:** `tests/e2e/board-sharing.spec.ts`

#### 10.1 共有リンクコピー
**Steps:**
1. ボード画面で「共有」ボタンをクリック
2. ShareLinkModal で「共有リンクをコピー」ボタンをクリック

**Expected Results:**
- 共有URL (`/s/[token]`) がクリップボードにコピーされる
- 成功メッセージが表示される

#### 10.2 共有ボード表示
**Steps:**
1. 共有リンクを新しいタブで開く

**Expected Results:**
- read-only モードでボードが表示される
- 「デモモード: このボードは読み取り専用です」メッセージが表示される
- すべてのタスクが `disabled` 状態
- タスクの追加・編集・削除ができない

#### 10.3 共有ボードから自分のボードを作成
**Steps:**
1. 共有ボード (`/s/[token]`) にアクセス
2. 「自分のボードを作成」リンクをクリック

**Expected Results:**
- `/b/new` ページへ遷移
- 新しいボードが作成される

---

### 11. デモボード

**Seed:** `tests/e2e/demo-board.spec.ts`

#### 11.1 デモボード基本表示
**Steps:**
1. `/s/DEMO` にアクセス

**Expected Results:**
- ページタイトルが「AIsen デモボード - 9件のタスク」
- H1が「AIsen デモボード」
- 説明文が「重要と緊急を自動判定。4象限マトリクスで時間を取り戻す。（9件のタスク）」
- 4象限に合計9件のタスクが配置されている

#### 11.2 デモボードのタスク内容確認
**Steps:**
1. 各象限のタスクを確認

**Expected Results:**
- **Q1（2件）**:
  - 「クライアント提案書を完成させる」（優先度95、期限あり）
  - 「サーバー障害の対応」（優先度98）
- **Q2（3件）**:
  - 「チーム研修の企画」（優先度75、期限あり）
  - 「新規プロジェクトの要件定義」（優先度70）
  - 「四半期レポート作成」（優先度80、期限あり）
- **Q3（2件）**:
  - 「出席だけしておけばいい定例会議」（優先度45、期限あり）
  - 「フォーマットに数字を転記するだけの作業」（優先度40）
- **Q4（2件）**:
  - 「デスク周りの整理」（優先度20）
  - 「古いメールの整理」（優先度15）

#### 11.3 デモボードのread-only制約
**Steps:**
1. デモボードでタスクカードをクリック

**Expected Results:**
- タスクは `disabled` 状態でクリックできない
- または、クリックしても何も起こらない
- 「新しいタスクを追加」ボタンが表示されない

---

### 12. サイドバー・ナビゲーション

**Seed:** `tests/e2e/navigation.spec.ts`

#### 12.1 サイドバー開閉
**Steps:**
1. ボード画面左側のサイドバーアイコンをクリック

**Expected Results:**
- サイドバーが展開する
- 「ボード一覧」が表示される
- 「新しいボードを作成」ボタンが表示される

#### 12.2 ボード一覧（ログイン前）
**Steps:**
1. サイドバーを開く
2. ボード一覧を確認

**Expected Results:**
- 「まだボードがありません」メッセージが表示される
- 「ログインしてボードを保存しましょう」メッセージが表示される

#### 12.3 新しいボードを作成
**Steps:**
1. サイドバーの「新しいボードを作成」ボタンをクリック

**Expected Results:**
- `/b/new` へ遷移
- 新規ボードが作成される

---

### 13. AIブレインストーミング（Pro機能）

**Seed:** `tests/e2e/ai-brainstorm.spec.ts`

#### 13.1 AIブレインストーミング起動（未ログイン）
**Steps:**
1. タスク配置モーダルを開く
2. タイトルに「新規プロジェクトの企画」と入力
3. 「AIとブレインストーミングする」ボタンをクリック

**Expected Results:**
- ログインモーダルが表示される
- 「ログインして使ってみる」ボタンが表示される
- 使用回数表示：「今日の残り: ー / 5」

#### 13.2 AIブレインストーミング起動（ログイン後）
**Steps:**
1. ログイン後、タスク配置モーダルを開く
2. タイトルに「新規プロジェクトの企画」と入力
3. 「AIとブレインストーミングする」ボタンをクリック

**Expected Results:**
- BrainstormChat UIが表示される
- AIからの提案メッセージが表示される
- ユーザーが返信できる入力欄が表示される
- 使用回数が表示される（例: 「今日の残り: 4 / 5」）

#### 13.3 AIブレインストーミング使用制限
**Steps:**
1. ログイン後、AIブレインストーミングを5回使用

**Expected Results:**
- 5回目使用後、「今日の残り: 0 / 5」と表示される
- 「AIとブレインストーミングする」ボタンが `disabled` になる
- 翌日（JST 0:00）にリセットされる

---

### 14. Gmail連携（Pro機能）

**Seed:** `tests/e2e/gmail-integration.spec.ts`

#### 14.1 Gmail連携提案カード表示
**Steps:**
1. ボード画面でタスクを3件以上作成

**Expected Results:**
- GmailSuggestionCard が表示される
- 「Gmail連携できますよ」的なメッセージが表示される
- 連携ボタンが表示される

#### 14.2 Gmail連携提案カード非表示
**Steps:**
1. GmailSuggestionCard の「×」ボタンをクリック

**Expected Results:**
- カードが非表示になる
- LocalStorageに非表示設定が保存される
- リロード後も非表示のまま

#### 14.3 Inbox画面へアクセス（Pro機能）
**Steps:**
1. `/inbox` にアクセス

**Expected Results:**
- Inbox画面が表示される
- Gmail連携が未設定の場合、連携を促すメッセージが表示される
- 連携済みの場合、取り込んだタスク候補が表示される

---

### 15. レスポンシブデザイン

**Seed:** `tests/e2e/responsive.spec.ts`

#### 15.1 モバイルビュー（375x667）
**Steps:**
1. ビューポートを 375x667 に設定
2. ボード画面にアクセス

**Expected Results:**
- 4象限が縦スクロール可能なレイアウトで表示される
- ハンバーガーメニューが表示される
- タスクカードが画面幅に収まる
- すべての操作が可能

#### 15.2 タブレットビュー（768x1024）
**Steps:**
1. ビューポートを 768x1024 に設定
2. ボード画面にアクセス

**Expected Results:**
- 4象限が2x2グリッドで表示される
- ナビゲーションが適切に表示される
- ドラッグ&ドロップが機能する

#### 15.3 デスクトップビュー（1920x1080）
**Steps:**
1. ビューポートを 1920x1080 に設定
2. ボード画面にアクセス

**Expected Results:**
- 4象限が横並びで表示される
- サイドバーが展開表示される
- すべての機能が最適なレイアウトで利用可能

---

### 16. エラーハンドリング

**Seed:** `tests/e2e/error-handling.spec.ts`

#### 16.1 存在しないボードID
**Steps:**
1. `/b/invalid-board-id-123456` にアクセス

**Expected Results:**
- 新規ボードが作成される、または
- 404エラーページが表示される

#### 16.2 ネットワークエラー時の挙動
**Steps:**
1. ボード画面でネットワークを切断
2. タスクを作成

**Expected Results:**
- タスクはLocalStorageに保存される
- エラーメッセージが表示される（Firestore同期失敗）
- ネットワーク復帰後、自動的に同期される

#### 16.3 無効なトークンでの共有ボードアクセス
**Steps:**
1. `/s/invalid-token-xyz` にアクセス

**Expected Results:**
- エラーメッセージが表示される
- または、空のボードが表示される

---

### 17. LocalStorage永続性

**Seed:** `tests/e2e/local-storage.spec.ts`

#### 17.1 ボードデータの永続化
**Steps:**
1. 新規ボードを作成
2. タスクを複数作成
3. ブラウザをリロード

**Expected Results:**
- 作成したタスクがすべて保持されている
- タスクの順序が保持されている
- 完了状態が保持されている

#### 17.2 複数ボードの管理
**Steps:**
1. ボードAを作成してタスクを追加
2. ボードBを作成してタスクを追加
3. ボードAのURLに戻る

**Expected Results:**
- ボードAの状態が保持されている
- ボードBの状態も独立して保存されている
- LocalStorageに両方のボードデータが存在する

---

### 18. パフォーマンス

**Seed:** `tests/e2e/performance.spec.ts`

#### 18.1 大量タスク表示
**Steps:**
1. 各象限に50件ずつタスクを作成（計200件）

**Expected Results:**
- ページが3秒以内にレンダリングされる
- スクロールがスムーズに動作する
- ドラッグ&ドロップが正常に機能する

#### 18.2 初回ロード時間
**Steps:**
1. ブラウザキャッシュをクリア
2. `/` にアクセス
3. Largest Contentful Paint (LCP) を測定

**Expected Results:**
- LCP が 2.5秒以内
- First Input Delay (FID) が 100ms以内
- Cumulative Layout Shift (CLS) が 0.1以下

---

### 19. アクセシビリティ

**Seed:** `tests/e2e/accessibility.spec.ts`

#### 19.1 キーボードナビゲーション
**Steps:**
1. ボード画面でTabキーを順次押す

**Expected Results:**
- すべてのインタラクティブ要素にフォーカスが移動する
- フォーカスの順序が論理的
- フォーカスインジケーターが明確に表示される

#### 19.2 スクリーンリーダー対応
**Steps:**
1. スクリーンリーダーを有効化
2. ボード画面を読み上げ

**Expected Results:**
- すべての重要な要素にaria-labelが設定されている
- ボタンやリンクが適切に読み上げられる
- 象限の見出しが正しく認識される

#### 19.3 コントラスト比
**Steps:**
1. すべてのテキスト要素のコントラスト比を確認

**Expected Results:**
- 通常テキストが 4.5:1 以上
- 大きいテキストが 3:1 以上
- WCAG AA 基準を満たす

---

### 20. セキュリティ

**Seed:** `tests/e2e/security.spec.ts`

#### 20.1 XSS防止
**Steps:**
1. タスクタイトルに `<script>alert('XSS')</script>` と入力
2. タスクを作成

**Expected Results:**
- スクリプトが実行されない
- テキストとしてエスケープされて表示される

#### 20.2 Firebase認証
**Steps:**
1. 未ログイン状態で `/settings` にアクセス

**Expected Results:**
- ログインページへリダイレクト、または
- ログインを促すメッセージが表示される

---

## テスト実行コマンド

```bash
# すべてのE2Eテストを実行
npm test

# UIモードでテスト実行（デバッグ用）
npm run test:ui

# デスクトップのみテスト
npm run test:desktop

# モバイルのみテスト
npm run test:mobile

# 特定のテストファイルのみ実行
npx playwright test tests/e2e/task-creation.spec.ts
```

---

## テスト環境

- **ブラウザ**: Chromium, Firefox, WebKit
- **ビューポート**:
  - デスクトップ: 1920x1080
  - タブレット: 768x1024
  - モバイル: 375x667
- **ベースURL**: http://localhost:3000

---

## 注意事項

### テスト前提条件
- すべてのテストは**独立して実行可能**
- テスト開始時は常に**空の状態（blank state）**を前提
- LocalStorageは各テスト前にクリア
- FirebaseエミュレーターまたはTest環境を使用

### テストデータ
- サンプルタスクは自動生成されるため、具体的な内容は変動する可能性あり
- テストで作成するタスクは**一意の名前**を使用
- 日付は動的に生成されるため、特定の日付を前提としない

### Pro機能のテスト
- Gmail連携とAI機能はAPIキーが必要
- テスト環境ではモック/スタブを使用
- 使用制限のテストは時刻依存のため、環境設定が必要

---

## まとめ

本テスト計画では、AIsenアプリケーションの全機能領域を網羅し、**Happy Path**（正常系）と**Edge Cases**（異常系）の両方をカバーしています。各シナリオは独立して実行可能で、明確なステップと期待結果を記載しているため、QAチームや開発者が容易に実施・自動化できます。

優先度の高いテストシナリオ:
1. **タスクCRUD操作**（3, 5, 6）
2. **ボード作成と共有**（2, 10）
3. **ドラッグ&ドロップ**（8）
4. **レスポンシブデザイン**（15）
5. **Pro機能**（13, 14）
