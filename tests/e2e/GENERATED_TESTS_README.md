# 生成されたE2Eテスト

このディレクトリには、test-plan.mdに基づいて生成されたPlaywrightテストコードが含まれています。

## 生成されたテストファイル

### 1. task-creation.spec.ts
**優先度:** 最高
**カバレッジ:** テスト計画書の「3. タスク作成」セクション

**テストケース:**
- 3.1 新規タスク作成（最小構成）
  - タスク配置モーダルの表示確認
  - タイトル未入力時のバリデーション
  - Q1象限への配置
  - 追加日時の自動付与

- 3.2 新規タスク作成（詳細付き）
  - 詳細・サブタスクの入力
  - 期限設定
  - Q2象限への配置

- 3.3 各象限へのタスク作成
  - Q1, Q2, Q3, Q4すべての象限への配置確認

- 3.4 タスク作成キャンセル
  - キャンセルボタンによるモーダルクローズ
  - タスク未作成の確認

- 3.5 空タイトルでの作成防止
  - タイトル空欄時の「配置する」ボタン無効化

### 2. board-creation.spec.ts
**優先度:** 高
**カバレッジ:** テスト計画書の「2. 新規ボード作成とサンプルタスク」セクション

**テストケース:**
- 2.1 新規ボード作成
  - /b/new からのリダイレクト確認
  - ページタイトル検証
  - 4つのサンプルタスク自動配置
  - 自動保存メッセージ表示
  - URLブックマークガイド表示

- 2.2 URL永続性
  - ボード状態の永続化
  - リロード後のデータ保持
  - 別タブでの同一ボード表示
  - LocalStorageへの保存確認

### 3. demo-board.spec.ts
**優先度:** 高
**カバレッジ:** テスト計画書の「11. デモボード」セクション

**テストケース:**
- 11.1 デモボード基本表示
  - ページタイトル検証
  - H1とデモボード説明の表示
  - 9件のタスクカウント確認

- 11.2 デモボードのタスク内容確認
  - Q1（2件）のタスク確認
  - Q2（3件）のタスク確認
  - Q3（2件）のタスク確認
  - Q4（2件）のタスク確認

- 11.3 デモボードのread-only制約
  - デモモードメッセージ表示
  - タスク追加ボタンの無効化または非表示
  - タスククリック無効化
  - チェックボックス無効化

## テスト実行方法

### すべてのテストを実行
```bash
npm test
```

### 特定のテストファイルを実行
```bash
# タスク作成テスト
npx playwright test tests/e2e/task-creation.spec.ts

# ボード作成テスト
npx playwright test tests/e2e/board-creation.spec.ts

# デモボードテスト
npx playwright test tests/e2e/demo-board.spec.ts
```

### UIモードでデバッグ
```bash
npm run test:ui
```

### デスクトップのみテスト
```bash
npm run test:desktop
```

### モバイルのみテスト
```bash
npm run test:mobile
```

### 特定のテストケースを実行
```bash
npx playwright test -g "3.1 新規タスク作成"
```

## テストの前提条件

### 開発サーバーの起動
テスト実行前に開発サーバーが起動している必要があります：
```bash
npm run dev
```

playwright.config.tsで`webServer`が設定されているため、テスト実行時に自動的に起動されます。

### LocalStorageのクリア
各テストは独立して実行され、beforeEachフックで新しいボードが作成されます。

### データの分離
- テストは本番データに影響を与えません
- LocalStorageを使用したクライアントサイドのみの永続化
- Firebaseエミュレーターまたはテスト環境の使用を推奨

## テストの設計原則

### 1. 独立性
各テストは他のテストに依存せず、独立して実行可能です。

### 2. 明確なAssertion
すべてのexpectステートメントには明確な意図があり、テスト計画書の期待結果に対応しています。

### 3. タイムアウト設定
- ページロード: 15秒
- 個別アクション: 10秒（playwright.config.tsで設定）
- テスト全体: 60秒（playwright.config.tsで設定）

### 4. セレクター戦略
優先順位：
1. `getByRole` - アクセシビリティ対応のロールベース
2. `getByText` - テキストベース（正規表現対応）
3. `data-*属性` - カスタムデータ属性（data-quadrant等）
4. CSSセレクター - 最後の手段

### 5. クリーンなテストコード
- 適切なコメント
- 論理的なステップ分け
- 再利用可能なパターン

## データ属性の仮定

テストコードでは以下のdata属性を使用しています：

```typescript
// 象限セクション
[data-quadrant="Q1"]
[data-quadrant="Q2"]
[data-quadrant="Q3"]
[data-quadrant="Q4"]

// タスクカード
[data-testid="task-card"]
```

**注意:** これらの属性が実装に存在しない場合、実装側に追加する必要があります。

## 実装時の注意事項

### TaskPlacementModal
- タイトル入力フィールド: placeholder属性に「例: プロジェクトの提案書を作成」を含める
- 詳細入力フィールド: placeholder属性に「例: 市場調査、競合分析」を含める
- 期限入力: `<input type="date">` を使用
- 象限選択ボタン: 選択時に`ring-2`などのCSSクラスを追加
- 配置するボタン: タイトル未入力時は`disabled`属性

### ボードページ
- 各象限に`data-quadrant`属性を追加
- タスクカードに`data-testid="task-card"`を追加
- 自動保存メッセージを含める
- URLブックマークガイドを含める

### デモボード
- `/s/DEMO`ルートの実装
- 9件のサンプルタスクをハードコード
- read-onlyモード（pointer-events-none、disabledチェックボックス等）
- デモモードメッセージの表示

## 次のステップ

残りの優先度の高いテストシナリオ：
- タスク編集（5. タスク編集）
- タスク削除（6. タスク削除）
- タスク完了管理（7. タスク完了管理）
- ドラッグ&ドロップ（8. ドラッグ&ドロップ）

これらのテストも同様のパターンで生成可能です。

## トラブルシューティング

### テストがタイムアウトする
- 開発サーバーが正しく起動しているか確認
- ネットワークが遅い場合はタイムアウトを延長
- `page.waitForLoadState('domcontentloaded')`を追加

### セレクターが見つからない
- ブラウザUIモード(`npm run test:ui`)でデバッグ
- 実装側のHTML構造を確認
- セレクターを調整

### LocalStorageが保存されない
- ブラウザのプライバシー設定を確認
- シークレットモードでないことを確認

## 参考資料

- [Playwright公式ドキュメント](https://playwright.dev/)
- [テスト計画書](./test-plan.md)
- [既存のテスト例](./desktop/)
