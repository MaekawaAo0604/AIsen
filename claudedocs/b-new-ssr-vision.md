# `/b/new` SSR 将来イメージ

## 現状 (Phase 2.5実装)

- SSR時に仮タスク2件（Q1: 今日中 顧客対応、Q2: 採用戦略の見直し）を表示
- クライアント側で実データに差し替え
- 初回表示は「空の4象限＋サンプルタスク」

## 将来の理想的なSSR体験

### 初回訪問時（ボード未作成）

```
┌─────────────────────────────────────────┐
│ アイゼンハワー・マトリクス              │
│ タスクを重要度と緊急度で整理して...    │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ ＋ 新しいタスクを追加                   │
│ （qキーでも追加可能）                   │
└─────────────────────────────────────────┘

┌──────────┬──────────┐
│ Q1 今す  │ Q2 計画  │  ← 空の4象限
│ ぐやる   │ してやる │
│          │          │
│ [チュートリアル]     │
│ ここに緊急で重要な   │
│ タスクが配置されます │
├──────────┼──────────┤
│ Q3 誰か  │ Q4 やら  │
│ に任せる │ ない     │
└──────────┴──────────┘

💡 ヒント:
- 「今日中 顧客対応」と入力してみましょう
- AIが自動で適切な象限に配置します
```

### リピート訪問時（ローカルストレージにデータあり）

```
┌─────────────────────────────────────────┐
│ アイゼンハワー・マトリクス              │
│ 最終更新: 2分前                         │
└─────────────────────────────────────────┘

┌──────────┬──────────┐
│ Q1 今す  │ Q2 計画  │  ← 実際のタスクをSSR
│ ぐやる   │ してやる │
│          │          │
│ □ 顧客A  │ □ 採用   │
│   対応   │   戦略   │
│ □ バグ   │          │
│   修正   │          │
├──────────┼──────────┤
│ Q3 誰か  │ Q4 やら  │
│ に任せる │ ない     │
│ □ 会議室 │          │
│   予約   │          │
└──────────┴──────────┘
```

### ログインユーザー（Firebaseからフェッチ）

```
┌─────────────────────────────────────────┐
│ マイボード: プロジェクトA               │
│ 最終更新: 5分前 | 共有中                │
└─────────────────────────────────────────┘

[SSRで実データ表示 → クライアント側でリアルタイム同期]
```

## 技術的実装方針

### Phase 3.0 (将来)

1. **初回訪問検知**
   - cookies/localStorage確認
   - 未訪問なら「チュートリアル付き空ボード」をSSR
   - 既訪問なら「前回データ」または「空ボード」をSSR

2. **データソース優先順位**
   ```
   1. URL boardId → Firebaseフェッチ（ログイン時）
   2. localStorage → 前回の作業データ
   3. デフォルト → チュートリアル付き空ボード
   ```

3. **SSR最適化**
   - 初期HTMLに必要最小限のタスクを含める
   - スケルトン表示の削減
   - LCP改善（現在の「読み込み中...」を削除）

4. **段階的エンハンスメント**
   ```
   SSR (静的HTML)
   ↓
   Hydration (インタラクティブ化)
   ↓
   データ同期 (Firebaseリアルタイム)
   ↓
   完全機能 (D&D, Quick Add, AI判定)
   ```

## 優先度と実装タイミング

### Phase 2.5 (現在) ✅
- [x] SSR時に仮タスク表示
- [x] クライアント側で実データ差し替え

### Phase 3.0 (次期)
- [ ] 初回訪問時のチュートリアル表示
- [ ] localStorage統合（SSR時読み込み）
- [ ] スケルトンUI削除

### Phase 3.5 (将来)
- [ ] Firebase SSR統合（ログインユーザー）
- [ ] Edge Runtime最適化
- [ ] ISR (Incremental Static Regeneration) 検討

## 参考リンク

- [Next.js SSR Best Practices](https://nextjs.org/docs/app/building-your-application/rendering/server-components)
- [Firebase Admin SDK for SSR](https://firebase.google.com/docs/admin/setup)
- [Progressive Enhancement Pattern](https://web.dev/progressive-enhancement/)
